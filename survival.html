<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exploratory Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="exploratory1.html">Exploring Activity Trends and Patterns Using EDA</a>
    </li>
    <li>
      <a href="exploratory2.html">Exploring NYC Crime Data Using EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Analysis - R
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ordinalmodel.html">Analyzing Likert Scale of Depressive Symptoms</a>
    </li>
    <li>
      <a href="felonies.html">Differences in Mean Length of NYC Felonies</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Analysis - SAS
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="NHANES1.html">Alcohol and Smoking Using NHANES</a>
    </li>
    <li>
      <a href="NHANES2.html">Away-From-Home Meals and BMI</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    SQL Queries
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="sql.html">SQL Queries With NHANES Data </a>
    </li>
    <li>
      <a href="sql2.html">SQL Queries With Cancer Data </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Biostatistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="survival.html">Survival Analysis of Stroke Patients</a>
    </li>
    <li>
      <a href="malaria.html">Proposal for Phase III RCT</a>
    </li>
  </ul>
</li>
<li>
  <a href="resume.html">Resume</a>
</li>
<li>
  <a href="mailto:&lt;jmc525@cornell.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/jmc2392/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><br></p>
<style>
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #337ab7;
}

.navbar-default .navbar-collapse, .navbar-default .navbar-form {
background-color: #337ab7;
}

#Drop-Down Menu Color
.navbar-default .navbar-nav>.open>a, .navbar-default .navbar-nav>.open>a:focus, .navbar-default .navbar-nav>.open>a:hover {
background-color: #337ab7;
}

.navbar-default {
background-color: #337ab7;
}

.navbar-default .navbar-nav>li>a {
color: white;
font-weight: bold;
}

.navbar-default .navbar-brand {
color: white;
font-weight: bold;
}

</style>
<script>
$(document).ready(function() {
  $items = $('div#TOC li');
  $items.each(function(idx) {
    num_ul = $(this).parentsUntil('#TOC').length;
    $(this).css({'text-indent': num_ul * 10, 'padding-left': 0});
  });

});
</script>
<div id="survival-analysis-of-stroke-patients" class="section level2">
<h2>Survival Analysis of Stroke Patients</h2>
<p><br></p>
<div id="skills" class="section level3">
<h3>Skills</h3>
<ul>
<li>Survival Analysis</li>
<li>R</li>
<li>SAS</li>
<li>Model Fitting</li>
</ul>
<p><br></p>
</div>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>The <a href="data/stroke_data.csv">stroke_data.csv</a> files provides the time until death (in days) for 500 patients following their hospital admission for incidences of stroke. For this analysis, we are interested in whether the rate of death is different between patients who experienced a stroke for the first time and those who have had a recurrent stroke. The number of days from hospital admission to last follow-up, as well as their vital status was recorded. Other variables, such as age, BMI, and year of admission into the hospital were also recorded. The variables (from left to right) are:</p>
<p>
<code>ID</code> = Patient ID <br>
<p>
<code>lenfol</code> = Days from Hospital Admission Date to Date of Last Follow-up <br>
<p>
<code>fstat</code> = Vital Status at Last Follow-up <br>
<p>
<ul>
<li>0 - Alive</li>
<li>1 - Dead <br></li>
</ul>
<p>
<code>stroke</code> = Stroke Type <br>
<p>
<ul>
<li>0 - First</li>
<li>1 - Recurrent <br></li>
</ul>
<p><code>bmi</code> = Body Mass Index <br></p>
<p>
<code>year</code> = Admission Year <br>
<p>
<ul>
<li>1 - 1997</li>
<li>2 - 1999</li>
<li>3 - 2001</li>
</ul>
<p>
<code>age_c</code> = Age at Hospital Admission <br>
<p>
<ul>
<li>1 - age &lt; 60</li>
<li>2 - 60 ≤ age &lt; 70</li>
<li>3 - 70 ≤ age &lt; 80</li>
<li>4 - ≥ 80</li>
</ul>
<p><br></p>
</div>
<div id="model-fitting---sas" class="section level3">
<h3>Model Fitting - SAS</h3>
<p><br></p>
<div id="model-1" class="section level4">
<h4>Model 1</h4>
<p>We first fit a Cox model with stroke recurrence as the only covariate (Model 1) and examine whether the rate of death is different between patients experiencing stroke for the first time and those experiencing a recurrent stroke at an alpha level of 0.05. The model statement is given below:</p>
<p>Model 1 (Stroke) Statement: ℎ(t,<em>x</em>,B) = h<sub>0</sub>(t)exp(B<sub>1</sub><em>x</em><sub>1</sub>) where <br></p>
<p><em>x</em><sub>1</sub> = (1 if Recurrent Stroke <br>         0 if First-Time Stroke)</p>
<p>From the SAS output below, we can see that the Wald test statistic is 9.2592; the Pr(<em>x</em><sup>2</sup><sub>1</sub> ≥9.2592) = 0.0023, which is less than alpha level of 0.05. Thus, at the 5% significance level, we reject the null hypothesis; there is sufficient data on hand to conclude that the rate of death between patients with first time incident stroke and recurrent stroke is statistically different.</p>
<p>Figure 1: SAS Code and Output for Model 1 <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig_sas.JPG&#39;)</code></pre>
<p><img src="images2/strokefig_sas.JPG" width="100%" style="background-color: #000000; padding:1px" /> <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig.JPG&#39;)</code></pre>
<p><img src="images2/strokefig.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
</div>
<div id="model-2" class="section level4">
<h4>Model 2</h4>
<p>We next fit a multivariate Cox model with age, BMI, and admission year as additional covariates. Patients aged less than 60 with first-time strokes admitted to the hospital in 1997 were used as the reference category. The model statement is given below:</p>
<p>Model 2 (Stroke, Age, BMI, Admission Year) Statement: h<sub>0</sub>(t)exp(B<sub>1</sub><em>x</em><sub>1</sub> + B<sub>2</sub><em>x</em><sub>2</sub> + B<sub>3</sub><em>x</em><sub>3</sub> + B<sub>4</sub><em>x</em><sub>4</sub> + B<sub>5</sub><em>x</em><sub>5</sub> + B<sub>6</sub><em>x</em><sub>6</sub> + B<sub>7</sub><em>x</em><sub>7</sub>) where <br></p>
<p><em>x</em><sub>1</sub> = (1 if Recurrent Stroke <br>         (0 if First-Time Stroke <br></p>
<p><em>x</em><sub>2</sub> = (1 if 60 ≤ age &lt; 70 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>3</sub> = (1 if 70 ≤ age &lt; 80 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>4</sub> = (1 if age ≥ 80 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>5</sub> = BMI <br></p>
<p><em>x</em><sub>6</sub> = (1 if admission year = 1999 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>7</sub> = (1 if if admission year = 2001 <br>         (0 if otherwise <br></p>
<p>From the SAS output below, we can see that the Wald test statistic is 1.2225; the Pr(<em>x</em><sup>2</sup><sub>7</sub> ≥1.2225) = 0.2689, which is greater than alpha level of 0.05. Thus, at the 5% significance level, we fail to reject the null hypothesis; there is insufficient data on hand to conclude that the rate of death between patients with first time incident stroke and recurrent stroke is statistically different, after adjusting for age, BMI, and admission year.</p>
<p>Figure 2: SAS Code and Output for Model 2 <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig2_sas.JPG&#39;)</code></pre>
<p><img src="images2/strokefig2_sas.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig2.JPG&#39;)</code></pre>
<p><img src="images2/strokefig2.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<div id="likelihood-ratio-test" class="section level5">
<h5>Likelihood Ratio Test</h5>
<p>Using the partial likelihood ratios from Model 1 and Model 2, we can determine whether Model 2 is a signficantly better fit than Model 1, by subtracting the partial likelihood for the larger model from that for the smaller model (Figure 3). Pr(<em>x</em><sup>2</sup><sub>6</sub> ≥ 137.85) &lt; 0.05 (using a chi-squared distribution table) is less than alpha level of 0.05. Thus, at the 5% significance level, there is sufficient data on hand to conclude that Model 2 is a significantly better fit than Model 1.</p>
<p>Figure 3: Testing Model 1 and Model 2 Fit <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/model2_lr.JPG&#39;)</code></pre>
<p><img src="images2/model2_lr.JPG" width="55%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
</div>
</div>
<div id="model-3" class="section level4">
<h4>Model 3</h4>
<p>We hypothesize that recurrence of stroke varies by age of the patient. Therefore, we now fit a multivariate Cox model with stroke recurrence, age, BMI, admission year as covariates, along with an interaction term between stroke recurrence and age. Again, patients aged less than 60 with first-time strokes admitted to the hospital in 1997 were used as the reference category. The model statement is given below:</p>
<p>Model 3 (Stroke, Age, BMI, Admission Year, StrokexAge) Statement: h<sub>0</sub>(t)exp(B<sub>1</sub><em>x</em><sub>1</sub> + B<sub>2</sub><em>x</em><sub>2</sub> + B<sub>3</sub><em>x</em><sub>3</sub> + B<sub>4</sub><em>x</em><sub>4</sub> + B<sub>5</sub><em>x</em><sub>5</sub> + B<sub>6</sub><em>x</em><sub>6</sub> + B<sub>7</sub><em>x</em><sub>7</sub> + B<sub>8</sub><em>x</em><sub>1</sub><em>x</em><sub>2</sub> + B<sub>9</sub><em>x</em><sub>1</sub><em>x</em><sub>3</sub> + B<sub>10</sub><em>x</em><sub>1</sub><em>x</em><sub>4</sub>) where <br></p>
<p><em>x</em><sub>1</sub> = (1 if Recurrent Stroke <br>         (0 if First-Time Stroke <br></p>
<p><em>x</em><sub>2</sub> = (1 if 60 ≤ age &lt; 70 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>3</sub> = (1 if 70 ≤ age &lt; 80 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>4</sub> = (1 if age ≥ 80 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>5</sub> = BMI <br></p>
<p><em>x</em><sub>6</sub> = (1 if admission year = 1999 <br>         (0 if otherwise <br></p>
<p><em>x</em><sub>7</sub> = (1 if if admission year = 2001 <br>         (0 if otherwise <br></p>
<p>From the SAS output below, we can see that the Wald test statistic is 4.4958; the Pr(<em>x</em><sup>2</sup><sub>10</sub> ≥4.4958) = 0.034, which is less than alpha level of 0.05. Thus, at the 5% significance level, we reject the null hypothesis; there is sufficient data on hand to conclude that the rate of death between patients with first time incident stroke and recurrent stroke is statistically different, after adjusting for age, BMI, admission year, and an interaction term between stroke recurrence and age.</p>
<p>Figure 4: SAS Code and Output for Model 3 <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig3_sas.JPG&#39;)</code></pre>
<p><img src="images2/strokefig3_sas.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig3.JPG&#39;)</code></pre>
<p><img src="images2/strokefig3.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<div id="likelihood-ratio-test-1" class="section level5">
<h5>Likelihood Ratio Test</h5>
<p>Using the partial likelihood ratios from Model 2 and Model 3, we can determine whether Model 3 is a signficantly better fit than Model 2, by subtracting the partial likelihood for the larger model from that for the smaller model (Figure 5). Pr(<em>x</em><sup>2</sup><sub>3</sub> ≥ 14.594) &lt; 0.05 (using a chi-squared distribution table) is less than alpha level of 0.05. Thus, at the 5% significance level, there is sufficient data on hand to conclude that Model 3 is a significantly better fit than Model 2.</p>
<p>Figure 5: Testing Model 2 and Model 3 Fit <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/model3_lr.JPG&#39;)</code></pre>
<p><img src="images2/model3_lr.JPG" width="55%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
</div>
<div id="testing-ph-assumption" class="section level5">
<h5>Testing PH Assumption</h5>
<p>Before we proceed with plotting the survival curves and making predictions for certain patients, we quickly check that the proportional hazards assumption holds for Model 3. The SAS output below shows that the predictors in our model meet the PH assumption.</p>
<p>Figure 6: Testing for PH Assumption <br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/phassume.JPG&#39;)</code></pre>
<p><img src="images2/phassume.JPG" width="55%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
</div>
</div>
<div id="predictions-and-survival-curves" class="section level4">
<h4>Predictions and Survival Curves</h4>
<p>Using Model 3, we can make predict the hazard (i.e., rate) of death for patients with any given covariate.</p>
<p>For example, the estimated hazard ratio for a patient aged 60 to 70 who experienced recurrrent stroke compared to a patient of the same age who experienced stroke for the first time is 4.556 - that is, the rate of death for a patient aged 60 to 70 who experienced recurrent stroke is 4.556 times that for a patient of the same age who experienced stroke for the first time, after controlling for BMI, admission year, and the interaction term between stroke recurrence and age. The SAS code and output are show below.</p>
<p>Figure 7: Hazard Ratio for Stroke = 1 Vs. 0, Age_C = 2</p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig4_sas.JPG&#39;)</code></pre>
<p><img src="images2/strokefig4_sas.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig4.JPG&#39;)</code></pre>
<p><img src="images2/strokefig4.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<p>Lastly, we can predict survival curves with our model and estimate the probability of survival after a certain time point (or death up to a given time point). Using the SAS code below, we plot the survival functions of a patient aged 80 or older who experienced recurrent stroke with BMI = 30 admitted in 1997, and a patient aged 80 or older who experienced stroke for the first time with BMI = 30 admitted in 1997.</p>
<p>Figure 8: Survival Curves for Stroke = 1 Vs. 0, Age_C = 4</p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig5_sas.JPG&#39;)</code></pre>
<p><img src="images2/strokefig5_sas.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<pre class="r"><code>knitr::include_graphics(&#39;images2/strokefig5.JPG&#39;)</code></pre>
<p><img src="images2/strokefig5.JPG" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
</div>
</div>
<div id="model-fitting---r" class="section level3">
<h3>Model Fitting - R</h3>
<p>We now try to reproduce our models above using R. We first import the dataset and include the column names. From the output below, we can see that the code successfully imported and tidied the data.</p>
<pre class="r"><code>library(&quot;survival&quot;)</code></pre>
<pre><code>## Warning: package &#39;survival&#39; was built under R version 3.5.3</code></pre>
<pre><code>## 
## Attaching package: &#39;survival&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     colon</code></pre>
<pre class="r"><code>library(&quot;survminer&quot;)</code></pre>
<pre><code>## Warning: package &#39;survminer&#39; was built under R version 3.5.3</code></pre>
<pre><code>## Loading required package: ggpubr</code></pre>
<pre><code>## Loading required package: magrittr</code></pre>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<pre class="r"><code>library(&quot;ggplot2&quot;)
library(&quot;broom&quot;)
library(&quot;pixiedust&quot;)

stroke &lt;- read.csv(&quot;data/stroke_data.csv&quot;, header = FALSE)
colnames(stroke) &lt;- (c(&quot;id&quot;, &quot;lenfol&quot;, &quot;fstat&quot;, &quot;stroke&quot;, &quot;bmi&quot;, &quot;year&quot;, &quot;age_c&quot;))

knitr::kable(head(stroke))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">lenfol</th>
<th align="right">fstat</th>
<th align="right">stroke</th>
<th align="right">bmi</th>
<th align="right">year</th>
<th align="right">age_c</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2178</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">25.54051</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2172</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24.02398</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2190</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">22.14290</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">297</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">26.63187</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2131</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24.41255</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">23.24236</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p><br></p>
<div id="model-1-1" class="section level4">
<h4>Model 1</h4>
<p>As shown below, our univariate Cox model gives us identical results to those derived for Model 1 using SAS. The beta coefficient for our stroke variable is 0.4227; exponentiating the value gives us 1.526, indicating that the rate of death for patients who experienced a recurrent stroke is 1.526 times the rate for those who experienced a stroke for the first time. Note that R provided a z test statistic instead of the Wald Chi-Square test statistic derived from Model 1 using SAS; we can square the z test statistic and confirm that the result matches the Wald Chi-Square test statistic. Lastly, the p-value is also identical.</p>
<p>Figure 9: Model 1 Using R <br></p>
<pre class="r"><code>model1 &lt;- coxph(Surv(lenfol, fstat) ~ stroke, data = stroke)
summary(model1)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(lenfol, fstat) ~ stroke, data = stroke)
## 
##   n= 500, number of events= 216 
## 
##          coef exp(coef) se(coef)     z Pr(&gt;|z|)   
## stroke 0.4227    1.5260   0.1389 3.043  0.00235 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##        exp(coef) exp(-coef) lower .95 upper .95
## stroke     1.526     0.6553     1.162     2.004
## 
## Concordance= 0.54  (se = 0.017 )
## Rsquare= 0.018   (max possible= 0.993 )
## Likelihood ratio test= 9  on 1 df,   p=0.003
## Wald test            = 9.26  on 1 df,   p=0.002
## Score (logrank) test = 9.39  on 1 df,   p=0.002</code></pre>
<p><br></p>
</div>
<div id="model-2-1" class="section level4">
<h4>Model 2</h4>
<p>We next fit a multivariate Cox model with age, BMI, and admission year as additional covariates. We include “factor” in our code for any multi-level categorical variables; note that we also have the option of changing our reference category for any categorical predictors by using <code>relevel(factor( ), ref = ' ')</code>.</p>
<p>From the R output below, we can see that the z test statistic is 1.106; the Pr(|z| ≥1.106) = 0.2689, which is greater than alpha level of 0.05. Thus, at the 5% significance level, we fail to reject the null hypothesis; there is insufficient data on hand to conclude that the rate of death between patients with first time incident stroke and recurrent stroke is statistically different, after adjusting for age, BMI, and admission year. These results are identical to those derived from Model 2 using SAS. Note that the likeihood ratio test results provided below only test whether the current model is a better fit than the null model.</p>
<p>Figure 10: Model 2 Using R <br></p>
<pre class="r"><code>model2 &lt;- coxph(Surv(lenfol, fstat) ~ stroke + factor(age_c) + bmi + factor(year), data = stroke)
summary(model2)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(lenfol, fstat) ~ stroke + factor(age_c) + 
##     bmi + factor(year), data = stroke)
## 
##   n= 500, number of events= 216 
## 
##                    coef exp(coef) se(coef)      z Pr(&gt;|z|)    
## stroke          0.15527   1.16797  0.14043  1.106  0.26888    
## factor(age_c)2  0.44417   1.55919  0.32507  1.366  0.17182    
## factor(age_c)3  1.50327   4.49637  0.26694  5.632 1.79e-08 ***
## factor(age_c)4  1.82475   6.20126  0.26106  6.990 2.75e-12 ***
## bmi            -0.05168   0.94964  0.01521 -3.397  0.00068 ***
## factor(year)2   0.19237   1.21211  0.17349  1.109  0.26752    
## factor(year)3   0.64523   1.90643  0.19225  3.356  0.00079 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                exp(coef) exp(-coef) lower .95 upper .95
## stroke            1.1680     0.8562    0.8869    1.5381
## factor(age_c)2    1.5592     0.6414    0.8245    2.9485
## factor(age_c)3    4.4964     0.2224    2.6647    7.5871
## factor(age_c)4    6.2013     0.1613    3.7176   10.3442
## bmi               0.9496     1.0530    0.9217    0.9784
## factor(year)2     1.2121     0.8250    0.8627    1.7030
## factor(year)3     1.9064     0.5245    1.3079    2.7788
## 
## Concordance= 0.732  (se = 0.017 )
## Rsquare= 0.254   (max possible= 0.993 )
## Likelihood ratio test= 146.8  on 7 df,   p=&lt;2e-16
## Wald test            = 117.1  on 7 df,   p=&lt;2e-16
## Score (logrank) test = 142.5  on 7 df,   p=&lt;2e-16</code></pre>
<p><br></p>
</div>
<div id="model-3-1" class="section level4">
<h4>Model 3</h4>
<p>We hypothesize that recurrence of stroke varies by age of the patient. Therefore, we now fit a multivariate Cox model with stroke recurrence, age, BMI, admission year as covariates, along with an interaction term between stroke recurrence and age. From the R output below, we can see that the z test statistic is 2.12; the Pr(|z| ≥2.12) = 0.034, which is less than alpha level of 0.05. Thus, at the 5% significance level, we reject the null hypothesis; there is sufficient data on hand to conclude that the rate of death between patients with first time incident stroke and recurrent stroke is statistically different, after adjusting for age, BMI, admission year, and an interaction term between stroke recurrence and age. The rate of death for those experiencing a recurrent stroke is 2.7085 times the rate of death for those experiecing a first-time stroke, after adjusting for age, BMI, admission year, and an interaction term between stroke recurrence and age.</p>
<p>Figure 11: Model 3 Using R <br></p>
<pre class="r"><code>model3 &lt;- coxph(Surv(lenfol, fstat) ~ stroke + factor(age_c) + bmi + factor(year) + stroke*factor(age_c), data = stroke)
summary(model3)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(lenfol, fstat) ~ stroke + factor(age_c) + 
##     bmi + factor(year) + stroke * factor(age_c), data = stroke)
## 
##   n= 500, number of events= 216 
## 
##                           coef exp(coef) se(coef)      z Pr(&gt;|z|)    
## stroke                 0.99638   2.70847  0.46992  2.120 0.033978 *  
## factor(age_c)2         0.09135   1.09565  0.48388  0.189 0.850257    
## factor(age_c)3         1.80208   6.06225  0.35233  5.115 3.14e-07 ***
## factor(age_c)4         2.27002   9.67956  0.33811  6.714 1.90e-11 ***
## bmi                   -0.04982   0.95140  0.01528 -3.261 0.001110 ** 
## factor(year)2          0.20882   1.23223  0.17373  1.202 0.229373    
## factor(year)3          0.64575   1.90741  0.19216  3.360 0.000778 ***
## stroke:factor(age_c)2  0.52010   1.68219  0.66678  0.780 0.435381    
## stroke:factor(age_c)3 -0.85055   0.42718  0.53271 -1.597 0.110344    
## stroke:factor(age_c)4 -1.18878   0.30459  0.50896 -2.336 0.019507 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                       exp(coef) exp(-coef) lower .95 upper .95
## stroke                   2.7085     0.3692    1.0783    6.8033
## factor(age_c)2           1.0957     0.9127    0.4244    2.8285
## factor(age_c)3           6.0622     0.1650    3.0390   12.0931
## factor(age_c)4           9.6796     0.1033    4.9895   18.7783
## bmi                      0.9514     1.0511    0.9233    0.9803
## factor(year)2            1.2322     0.8115    0.8766    1.7321
## factor(year)3            1.9074     0.5243    1.3088    2.7798
## stroke:factor(age_c)2    1.6822     0.5945    0.4553    6.2149
## stroke:factor(age_c)3    0.4272     2.3409    0.1504    1.2135
## stroke:factor(age_c)4    0.3046     3.2831    0.1123    0.8259
## 
## Concordance= 0.743  (se = 0.017 )
## Rsquare= 0.276   (max possible= 0.993 )
## Likelihood ratio test= 161.4  on 10 df,   p=&lt;2e-16
## Wald test            = 115  on 10 df,   p=&lt;2e-16
## Score (logrank) test = 150.2  on 10 df,   p=&lt;2e-16</code></pre>
<p><br></p>
<div id="testing-ph-assumption-1" class="section level5">
<h5>Testing PH Assumption</h5>
<p>We run the code below to see of the PH assumption is violated. Since p-values are above 0.05, this indicates that the PH assumption was not violated.</p>
<p>Figure 12: Testing PH Assumption <br></p>
<pre class="r"><code>cox.zph(model3)</code></pre>
<pre><code>##                           rho   chisq     p
## stroke                 0.0282  0.1733 0.677
## factor(age_c)2        -0.0264  0.1517 0.697
## factor(age_c)3        -0.0107  0.0264 0.871
## factor(age_c)4         0.0434  0.4314 0.511
## bmi                    0.0622  1.0490 0.306
## factor(year)2          0.0270  0.1660 0.684
## factor(year)3          0.0741  1.2837 0.257
## stroke:factor(age_c)2  0.0308  0.2041 0.651
## stroke:factor(age_c)3  0.0467  0.4800 0.488
## stroke:factor(age_c)4 -0.0592  0.7688 0.381
## GLOBAL                     NA 10.6768 0.383</code></pre>
<p><br></p>
</div>
</div>
<div id="predictions-and-survival-curves-1" class="section level4">
<h4>Predictions and Survival Curves</h4>
<p>Below, I plot the average survival curve for the patients (by default, covariates are assigned mean values).</p>
<p>Figure 13: Average Survival Curve <br></p>
<pre class="r"><code>ggsurvplot(survfit(model3), data = stroke,  ylab = &quot;Survival Probability&quot;, title = &quot;Model 3 - Survival Curve&quot;, 
           palette = c(&quot;#075CA7&quot;), ggtheme = theme_classic2(), legend = &quot;bottom&quot;)</code></pre>
<p><img src="survival_files/figure-html/survival_curves-1.png" width="100%" style="background-color: #000000; padding:1px" /></p>
<p><br></p>
<p>Lastly, we can predict survival curves with our model and estimate the probability of survival after a certain time point (or death up to a given time point). Using the R code below, we plot the survival functions of a patient aged 80 or older who experienced recurrent stroke with BMI = 30 admitted in 1997, and a patient aged 80 or older who experienced stroke for the first time with BMI = 30 admitted in 1997. Note that you can use the code <code>summary(newmodel)</code> to view the median survival times shown in the plot below (as well as other survival probabilities); for SAS, the equivalent code above would be <code>proc print data = stroke2; run</code> (Figure 8).</p>
<pre class="r"><code>new_df &lt;- with(stroke, data.frame(id = c(1, 2), 
                                  fstat = c(1, 2), 
                                  stroke = c(1, 0),
                                  bmi = c(30, 30),
                                  year = c(1, 1),
                                  age_c = c(4, 4)))

new_df</code></pre>
<pre><code>##   id fstat stroke bmi year age_c
## 1  1     1      1  30    1     4
## 2  2     2      0  30    1     4</code></pre>
<pre class="r"><code>newmodel &lt;- survfit(model3, newdata = new_df, data = stroke)

ggsurvplot(newmodel, conf.int = FALSE, palette = c(&quot;#075CA7&quot;, &#39;#ff0000&#39;), surv.median.line = &quot;hv&quot;, legend.labs = c(&quot;ID=1&quot;, &quot;ID=2&quot;), ylab = &quot;Survival Probability&quot;, title = &quot;Survival Curves for Two Patients&quot;)</code></pre>
<p><img src="survival_files/figure-html/predicted_survivals-1.png" width="100%" style="background-color: #000000; padding:1px" /></p>
<p>𝑟𝑤𝑖𝑠𝑒</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
